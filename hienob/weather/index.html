<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Animation</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #e0e0e0;
            font-family: 'Arial', sans-serif;
            overflow: hidden;
        }
        canvas {
            display: block;
            width: 251px;
            height: 123px;
        }
    </style>
</head>
<body>
    <canvas id="weatherCanvas"></canvas>

    <script>
        const apiKey = 'd7c271d4a91c484584b160833242508'; // Your API key
        const canvas = document.getElementById('weatherCanvas');
        const context = canvas.getContext('2d');
        let icon, iconSize = 60;
        let pulseDirection = 1;

        function resizeCanvas() {
            canvas.width = 251;
            canvas.height = 123;
        }

        function getCityFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('city') || 'London'; // Default to London if no city is specified
        }

        async function fetchWeather(city) {
            try {
                const response = await fetch(`https://api.weatherapi.com/v1/current.json?key=${apiKey}&q=${city}`);
                if (!response.ok) {
                    throw new Error('Failed to fetch weather data');
                }
                const data = await response.json();
                drawWeather(data);
            } catch (error) {
                console.error('Error:', error);
                drawError();
            }
        }

        function drawWeather(data) {
            resizeCanvas();

            // Clear Canvas
            context.fillStyle = '#ffffff';
            context.fillRect(0, 0, canvas.width, canvas.height);

            // City Name
            context.fillStyle = '#333333';
            context.font = '10px Arial'; // Adjust font size for small canvas
            context.fillText(data.location.name, 5, 15); // Adjust positioning

            // Temperature
            context.fillStyle = '#ff6600';
            context.font = '12px Arial'; // Adjust font size for small canvas
            context.fillText(`${data.current.temp_c}°C`, 5, 35); // Adjust positioning

            // Weather Description
            context.fillStyle = '#666666';
            context.font = '8px Arial'; // Adjust font size for small canvas
            context.fillText(data.current.condition.text, 5, 55); // Adjust positioning

            // Weather Icon
            icon = new Image();
            icon.src = `https:${data.current.condition.icon}`;
            icon.onload = () => {
                animateCanvas();
            };
        }

        function drawError() {
            resizeCanvas();

            // Clear Canvas
            context.fillStyle = '#ffffff';
            context.fillRect(0, 0, canvas.width, canvas.height);

            // Error Message
            context.fillStyle = '#ff0000';
            context.font = '10px Arial'; // Adjust font size for small canvas
            context.fillText('Error loading data', 5, 60); // Adjust positioning
        }

        function animateCanvas() {
            let angle = 0;
            function animate() {
                resizeCanvas();

                // Clear Canvas
                context.fillStyle = '#ffffff';
                context.fillRect(0, 0, canvas.width, canvas.height);

                // Draw City Name
                context.fillStyle = '#333333';
                context.font = '10px Arial';
                context.fillText(getCityFromUrl(), 5, 15);

                // Draw Temperature
                context.fillStyle = '#ff6600';
                context.font = '12px Arial';
                context.fillText(`${icon ? '---' : 'N/A'}°C`, 5, 35);

                // Draw Weather Description
                context.fillStyle = '#666666';
                context.font = '8px Arial';
                context.fillText('---', 5, 55);

                // Animate Icon
                if (icon) {
                    context.save();
                    context.translate(canvas.width * 0.7 + iconSize / 2, canvas.height * 0.2 + iconSize / 2);
                    context.scale(pulseDirection, pulseDirection);
                    context.translate(-iconSize / 2, -iconSize / 2);
                    context.drawImage(icon, 0, 0, iconSize, iconSize);
                    context.restore();

                    // Pulse Effect
                    pulseDirection += 0.01;
                    if (pulseDirection > 1.1 || pulseDirection < 0.9) {
                        pulseDirection = pulseDirection > 1.1 ? 1.1 : 0.9;
                    }
                }

                // Continue animation
                requestAnimationFrame(animate);
            }
            animate();
        }

        window.addEventListener('resize', () => {
            fetchWeather(getCityFromUrl());
        });

        // Initial fetch
        fetchWeather(getCityFromUrl());
    </script>
</body>
</html>
